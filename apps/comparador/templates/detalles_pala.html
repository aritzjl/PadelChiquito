def mostrar_pala(request, pala_id):
    # Obtener la información detallada de la pala
    pala = Pala.objects.get(pk=pala_id)
    
    # Obtener el precio más reciente de cada tienda para esta pala
    tiendas = pala.tienda_set.all()
    precios_mas_recientes = []
    for tienda in tiendas:
        precios_tienda = PrecioPala.objects.filter(pala=pala, tienda=tienda).order_by('-fecha')
        if precios_tienda.exists():
            precio_mas_reciente = precios_tienda.first()
            precios_mas_recientes.append(precio_mas_reciente)
    
    # Obtener el historial de precios para la gráfica
    historial_precios = PrecioPala.objects.filter(pala=pala).order_by('fecha')
    fechas = [precio.fecha.strftime('%Y-%m-%d') for precio in historial_precios]
    precios = [precio.precio for precio in historial_precios]
    
    # Crear la gráfica con matplotlib
    plt.figure(figsize=(8, 6))
    plt.plot(fechas, precios, marker='o', linestyle='-')
    plt.title('Historial de precios')
    plt.xlabel('Fecha')
    plt.ylabel('Precio')
    plt.xticks(rotation=45)
    plt.tight_layout()

    # Guardar la gráfica en un buffer de BytesIO y convertirla a base64 para mostrarla en HTML
    buffer = BytesIO()
    plt.savefig(buffer, format='png')
    buffer.seek(0)
    grafica_base64 = base64.b64encode(buffer.getvalue()).decode('utf-8')
    plt.close()

    return render(request, 'mostrar_pala.html', {
        'pala': pala,
        'precios_mas_recientes': precios_mas_recientes,
        'grafica_base64': grafica_base64,
    })
Luego, necesitarás una plantilla HTML llamada mostrar_pala.html para mostrar esta información. Aquí hay un ejemplo básico de cómo podrías estructurar la plantilla:

html
Copy code
<!-- mostrar_pala.html -->

<h1>{{ pala.nombre }}</h1>

<!-- Información detallada de la pala -->
<p>Marca: {{ pala.marca }}</p>
<p>Precio: {{ pala.precio }}</p>
<!-- Agrega más detalles de la pala según tus necesidades -->

<!-- Sección de tiendas y precios más recientes -->
<h2>Tiendas y precios más recientes</h2>
<ul>
  {% for precio in precios_mas_recientes %}
    <li>{{ precio.tienda.nombre }} - Precio: {{ precio.precio }} - <a href="{{ precio.url }}">Enlace a la tienda</a></li>
  {% endfor %}
</ul>

<!-- Sección de historial de precios con la gráfica generada por matplotlib -->
<h2>Historial de precios</h2>
<img src="data:image/png;base64,{{ grafica_base64 }}" alt="Gráfica de historial de precios">